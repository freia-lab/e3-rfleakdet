record (stringout, "$(PREFIX):debug") {
  field(DESC,"Debugging interface")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto debug $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):debug-in") {
  field(DESC,"Listen to all replies")
  field(DTYP, "stream")
  field(NELM, "130")
  field(FTVL, "CHAR")
  field(SCAN, "I/O Intr")
  field(INP,"@rfleakdet.proto debugin $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Config") {
  field(DESC,"Read configuration")
  field(DTYP, "stream")
  field(SCAN, "10 second")
  field(NELM, "16")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getConfSelf $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Nodes-Conn:sIDs") {
  field(DESC,"Read connected nodes IDs")
  field(DTYP, "stream")
  field(SCAN, "10 second")
  field(NELM, "16")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getConnNodes $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Nodes-sAllowed:sIDs") {
  field(DESC,"Read Allowed nodes IDs")
  field(DTYP, "stream")
  field(SCAN, "10 second")
  field(NELM, "32")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getAllowedNodes $(RFDET_PORT)")
}

record (bi, "$(PREFIX):Mode:sMaster") {
  field(DESC,"Check if in master mode")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto isMaster $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Mode:cmdMaster") {
  field(DESC,"Set in master or slave mode")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto setMaster $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Mode:sMaster")
}

record (bo, "$(PREFIX):Master:cmdAllowAll") {
  field(DESC,"Allow all nodes")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto setAllowAllNodes $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}

record (longin, "$(PREFIX):Master:sN-conn") {
  field(DESC,"Number of connected nodes")
  field(DTYP, "stream")
  field(SCAN, "10 second")
  field(INP,"@rfleakdet.proto getNofNodes $(RFDET_PORT)")
}

record (longin, "$(PREFIX):Node:sId") {
  field(DESC,"Node Id readback")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getId $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Node:cId") {
  field(DESC,"Node Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setId $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Node:sId")
}

record (mbbiDirect, "$(PREFIX):Config:Status") {
  field(DESC,"Configuration status")
  field(NOBT, 8)
  field(DTYP, "stream")
  field(SCAN, "10 second")
  field(INP,"@rfleakdet.proto getStatus $(RFDET_PORT)")
}

# Commands

record (bo, "$(PREFIX):Config:Apply") {
  field(DESC,"Apply configuration settings")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto applyConfigBuf $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:Reboot") {
  field(DESC,"Reboot the node")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto reboot $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:Reset") {
  field(DESC,"Reset alarms and acq data")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto reset $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:RstNet") {
  field(DESC,"Reset network")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto reset $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:SavInFlash") {
  field(DESC,"Save configuration in flash")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto savConf $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:AddAllowedId") {
  field(DESC,"Add allowed Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto addAllowedNode $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}

record (longout, "$(PREFIX):Config:RmAllowedId") {
  field(DESC,"Remove allowed Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto rmAllowedNode $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}
