record (stringout, "$(PREFIX):debug") {
  field(DESC,"Debugging interface")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto debug $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):debug-in") {
  field(DESC,"Listen to all replies")
  field(DTYP, "stream")
  field(NELM, "130")
  field(FTVL, "CHAR")
  field(SCAN, "I/O Intr")
  field(INP,"@rfleakdet.proto debugin $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):RFdata") {
  field(DESC,"RF data of node connected to serial.")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(NELM, "10")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getRFdataSelf $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Config") {
  field(DESC,"Read configuration")
  field(DTYP, "stream")
  field(NELM, "16")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getConfSelf $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Nodes-Conn:sIDs") {
  field(DESC,"Read connected nodes IDs")
  field(DTYP, "stream")
  field(NELM, "16")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getConnNodes $(RFDET_PORT)")
}

record (waveform, "$(PREFIX):Nodes-sAllowed:sIDs") {
  field(DESC,"Read Allowed nodes IDs")
  field(DTYP, "stream")
  field(NELM, "32")
  field(FTVL, "SHORT")
  field(INP,"@rfleakdet.proto getAllowedNodes $(RFDET_PORT)")
}

record (bi, "$(PREFIX):Mode:sMaster") {
  field(DESC,"Check if in master mode")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto isMaster $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Mode:cmdMaster") {
  field(DESC,"Set in master or slave mode")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto setMaster $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Mode:sMaster")
}

record (bo, "$(PREFIX):Master:cmdAllowAll") {
  field(DESC,"Allow all nodes")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto setAllowAllNodes $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}

record (longin, "$(PREFIX):Master:sN-conn") {
  field(DESC,"Number of connected nodes")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP,"@rfleakdet.proto getNofNodes $(RFDET_PORT)")
}

record (longin, "$(PREFIX):Node:sId") {
  field(DESC,"Node Id readback")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getId $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Node:cId") {
  field(DESC,"Node Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setId $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Node:sId")
}

# Node Configuration PVs

record (longin, "$(PREFIX):Node:sAdr") {
  field(DESC,"Node's RF network address readback")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getAdr $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Node:cAdr") {
  field(DESC,"Node's RF network address")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setAdr $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Node:sAdr")
}

record (ai, "$(PREFIX):Config:sSamplRt") {
  field(DESC,"RF data sampling rate readback")
  field(EGU, "Hz")
  field(LINR, "SLOPE")
  field(ASLO, "10")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(smp) $(RFDET_PORT)")
}

record (ao, "$(PREFIX):Config:cSamplRt") {
  field(DESC,"RF data sampling rate")
  field(EGU, "Hz")
  field(LINR, "SLOPE")
  field(ASLO, "10")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(smp) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sSamplRt")
}

record (ai, "$(PREFIX):Config:sTxPeriod") {
  field(DESC,"Transmit period readback")
  field(EGU, "s")
  field(LINR, "SLOPE")
  field(ASLO, "0.1")
  field(PREC, "1")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(txt) $(RFDET_PORT)")
}

record (ao, "$(PREFIX):Config:cTxPeriod") {
  field(DESC,"Transmit period")
  field(EGU, "s")
  field(LINR, "SLOPE")
  field(ASLO, "0.1")
  field(PREC, "1")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(txt) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sTxPeriod")
}

record (longin, "$(PREFIX):Config:sPeakAlrm-1") {
  field(DESC,"Chan 1: Peak Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a1p) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cPeakAlrm-1") {
  field(DESC,"Chan 1: Peak Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a1p) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sPeakAlrm-1")
}

record (longin, "$(PREFIX):Config:sPeakAlrm-2") {
  field(DESC,"Chan 2: Peak Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a2p) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cPeakAlrm-2") {
  field(DESC,"Chan 2: Peak Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a2p) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sPeakAlrm-2")
}

record (longin, "$(PREFIX):Config:sPeakAlrm-3") {
  field(DESC,"Chan 3: Peak Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a3p) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cPeakAlrm-3") {
  field(DESC,"Chan 3: Peak Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a3p) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sPeakAlrm-3")
}

record (longin, "$(PREFIX):Config:sAvgAlrm-1") {
  field(DESC,"Chan 1: Avg Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a1a) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cAvgAlrm-1") {
  field(DESC,"Chan 1: Avg Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a1a) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAvgAlrm-1")
}

record (longin, "$(PREFIX):Config:sAvgAlrm-2") {
  field(DESC,"Chan 2: Avg Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a2a) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cAvgAlrm-2") {
  field(DESC,"Chan 2: Avg Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a2a) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAvgAlrm-2")
}

record (longout, "$(PREFIX):Config:cAvgAlrm-3") {
  field(DESC,"Chan 3: Avg Alarm Lvl")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(a3a) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAvgAlrm-3")
}

record (longin, "$(PREFIX):Config:sAvgAlrm-3") {
  field(DESC,"Chan 3: Avg Alarm Lvl Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(a3a) $(RFDET_PORT)")
}

record (longin, "$(PREFIX):Config:sAmplCalibr-1") {
  field(DESC,"Chan 1: Amplitude calibration Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(r1c) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cAmplCalibr-1") {
  field(DESC,"Chan 1: Amplitude calibration")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(r1c) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAmplCalibr-1")
}

record (longin, "$(PREFIX):Config:sAmplCalibr-2") {
  field(DESC,"Chan 2: Amplitude calibration Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(r2c) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cAmplCalibr-2") {
  field(DESC,"Chan 2: Amplitude calibration")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(r2c) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAmplCalibr-2")
}

record (longin, "$(PREFIX):Config:sAmplCalibr-3") {
  field(DESC,"Chan 3: Amplitude calibration Readback")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getConfBuf(r3c) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cAmplCalibr-3") {
  field(DESC,"Chan 3: Amplitude calibration")
  field(EGU, "dBm")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setConfBuf(r3c) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sAmplCalibr-3")
}

record (longin, "$(PREFIX):Config:sCalibrFreq-1") {
  field(DESC,"Chan 1: Calibration Frequency Readback")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getCalibrFreq(1) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cCalibrFreq-1") {
  field(DESC,"Chan 1: Calibration Frequency")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setCalibrFreq(1) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sCalibrFreq-1")
}

record (longin, "$(PREFIX):Config:sCalibrFreq-2") {
  field(DESC,"Chan 2: Calibration Frequency Readback")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getCalibrFreq(2) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cCalibrFreq-2") {
  field(DESC,"Chan 2: Calibration Frequency")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setCalibrFreq(2) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sCalibrFreq-2")
}

record (longin, "$(PREFIX):Config:sCalibrFreq-3") {
  field(DESC,"Chan 3: Calibration Frequency Readback")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(INP,"@rfleakdet.proto getCalibrFreq(3) $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:cCalibrFreq-3") {
  field(DESC,"Chan 3: Calibration Frequency")
  field(EGU, "MHz")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto setCalibrFreq(3) $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Config:sCalibrFreq-3")
}

record (mbbiDirect, "$(PREFIX):Config:sFlags") {
  field(DESC,"Configuration flags readback")
  field(NOBT, 8)
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP,"@rfleakdet.proto getConfBuf(cnf) $(RFDET_PORT)")
}

record (mbboDirect, "$(PREFIX):Config:cFlags") {
  field(DESC,"Configuration flags")
  field(NOBT, 8)
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto setConfBuf(cnf) $(RFDET_PORT)")
#  field(FLNK, "$(PREFIX):Config:sFlags")
}


# Commands

record (bo, "$(PREFIX):Config:Apply") {
  field(DESC,"Apply configuration settings")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto applyConfigBuf $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:Reboot") {
  field(DESC,"Reboot the node")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto reboot $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:Reset") {
  field(DESC,"Reset alarms and acq data")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto reset $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:RstNet") {
  field(DESC,"Reset network")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto resetNetwork $(RFDET_PORT)")
}

record (bo, "$(PREFIX):Config:SavInFlash") {
  field(DESC,"Save configuration in flash")
  field(DTYP, "stream")
  field(OUT,"@rfleakdet.proto savConf $(RFDET_PORT)")
}

record (longout, "$(PREFIX):Config:AddAllowedId") {
  field(DESC,"Add allowed Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto addAllowedNode $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}

record (longout, "$(PREFIX):Config:RmAllowedId") {
  field(DESC,"Remove allowed Id")
  field(DTYP, "stream")
  field(SCAN, "Passive")
  field(OUT,"@rfleakdet.proto rmAllowedNode $(RFDET_PORT)")
  field(FLNK, "$(PREFIX):Nodes-sAllowed:sIDs")
}

# Help pvs
record (fanout, "$(PREFIX):Config:Refresh") {
  field(DESC,"Uppdate all read data")
  field(SCAN, "Passive")
  field(SELM, "All")
  field(LNK1,"$(PREFIX):Config:Refresh-1")
  field(LNK2,"$(PREFIX):Config:Refresh-2")
  field(LNK3,"$(PREFIX):Config:Refresh-3")
  field(LNK4,"$(PREFIX):Config:Refresh-4")
 }

record (fanout, "$(PREFIX):Config:Refresh-1") {
  field(DESC,"Uppdate all read data")
  field(SCAN, "Passive")
  field(SELM, "All")
  field(LNK1,"$(PREFIX):Config")
  field(LNK2,"$(PREFIX):Nodes-Conn:sIDs")
  field(LNK3,"$(PREFIX):Nodes-sAllowed:sIDs")
  field(LNK4,"$(PREFIX):Mode:sMaster")
  field(LNK5,"$(PREFIX):Master:sN-conn")
  field(LNK6,"$(PREFIX):Node:sId")
 }

record (fanout, "$(PREFIX):Config:Refresh-2") {
  field(DESC,"Uppdate all read data")
  field(SCAN, "Passive")
  field(SELM, "All")
  field(LNK1,"$(PREFIX):Node:sAdr")
  field(LNK2,"$(PREFIX):Config:sSamplRt")
  field(LNK3,"$(PREFIX):Config:sTxPeriod")
  field(LNK4,"$(PREFIX):Config:sPeakAlrm-1")
  field(LNK5,"$(PREFIX):Config:sPeakAlrm-2")
  field(LNK6,"$(PREFIX):Config:sPeakAlrm-3")
 }

record (fanout, "$(PREFIX):Config:Refresh-3") {
  field(DESC,"Uppdate all read data")
  field(SCAN, "Passive")
  field(SELM, "All")
  field(LNK1,"$(PREFIX):Config:sAvgAlrm-1")
  field(LNK2,"$(PREFIX):Config:sAvgAlrm-2")
  field(LNK3,"$(PREFIX):Config:sAvgAlrm-3")
  field(LNK4,"$(PREFIX):Config:sAmplCalibr-1")
  field(LNK5,"$(PREFIX):Config:sAmplCalibr-2")
  field(LNK6,"$(PREFIX):Config:sAmplCalibr-3")
 }

record (fanout, "$(PREFIX):Config:Refresh-4") {
  field(DESC,"Uppdate all read data")
  field(SCAN, "Passive")
  field(SELM, "All")
  field(LNK1,"$(PREFIX):Config:sCalibrFreq-1")
  field(LNK2,"$(PREFIX):Config:sCalibrFreq-2")
  field(LNK3,"$(PREFIX):Config:sCalibrFreq-3")
 # field(LNK4,"$(PREFIX):Config:sFlags")
 }

